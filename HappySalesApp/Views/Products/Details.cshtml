@model HappySalesApp.ViewModels.ProductsAndCategoriesViewModel
@using HappySalesApp.Areas.Identity.Pages.Account;
@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager

@{
    ViewData["Title"] = "Om annonsen";
}
<div class="main">

    <h1>Om annonsen</h1>
    <div>
        <a asp-action="Index">Tillbaka till alla annonser</a>
    </div>

    <!--Flexbos med kategorier och produktlistning-->
    <div class="flex-container">
        <div class="flex-nav">
            <img decoding="async" src="@("~/uploadedimages/"+Model.Product.ImageName)" asp-append-version="true" width="500px" height="500px" />
        </div>



        <div class="products-flex">
            <!--Artikel där produkterna skrivs ut-->
            <div class="details">

                <h3>
                    @Html.DisplayFor(model => model.Product.Name)
                </h3>
                <p>@Html.DisplayFor(model => model.Product.Name)</p>
                <p>@Html.DisplayFor(model => model.Product.Price)</p>
                <p>Annonsen skapades: @Html.DisplayFor(model => model.Product.CreatedDate) och uppdaterades senast @Html.DisplayFor(model => model.Product.LastModifiedDate) </p>


                @if (SignInManager.IsSignedIn(User))
                {
                    //Skickar med produktens id som parameter i länken
                    <a href="@Url.Action("Create", "Bids", new { id = Model.Product.Id })">Lägg ett bud</a>

                }else{
                    <a class="nav-link text-dark" asp-area="Identity" asp-page="/Account/Login">Logga in för att lägga ett bud</a>
                }

                <h2>Bud</h2>
                <!--Kontroll om det finns något bud och skriver ut-->
                @if (Model.Bids.Any())
                {
                    <!--Loopar igenom buden och skriver ut. Formatterar om utskrift av "Amount" och tar bort extra nollor-->
                    @foreach (var bid in Model.Bids)
                    {
                        <p>@String.Format("{0:N2}", bid.Amount) kr | @bid.CreatedDate</p>
                    }
                }
                else
                {
                    <p>Denna produkt har inget bud</p>
                }

            </div>
        </div>
    </div>
</div>
